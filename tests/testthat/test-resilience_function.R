test_that("resilience works as expected", {

  job <-
    resilience(
      listA = adeliepenguin,
      metrics = "all",
      bounds = TRUE,
      vector = Cranevec1,
      TDvector = FALSE,
      popname = "blue crane",
      time = "varying",
      verbose = FALSE
    )

  result <- structure(
    list(
      timestep = 1:12,
      popname = c(
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane",
        "blue crane"
      ),
      convt_TV = c(15, 17, 15, 17, 12, 15, 15, 12, 15, 17, 12, 15),
      convt_lwr_TV = c(17, 22, 17, 20, 14, 17, 17, 14, 17, 22, 14, 14),
      convt_upr_TV = c(21, 26, 21, 24, 18, 21, 21, 18, 21, 26, 18, 18),
      dr_TV = c(
        1.26073652221993,
        1.20927657750184,
        1.25091177438405,
        1.22204196278867,
        1.32735285628836,
        1.2757436734504,
        1.28879750192247,
        1.31332974378368,
        1.24720963993208,
        1.21487723860581,
        1.31243447389243,
        1.29025308723385
      ),
      inertia_TV = c(
        1.53333482895959,
        1.62496953889147,
        1.53621992370344,
        1.59218522223508,
        1.46675338615796,
        1.51005069650397,
        1.49108243560096,
        1.47538322681293,
        1.54184215001863,
        1.607625924247,
        1.47883517721564,
        1.49528216022151
      ),
      inertia_lwr_TV = c(
        0.33806427350658,
        0.366414418703459,
        0.345790018272096,
        0.360164729899448,
        0.305845279670787,
        0.331522281620042,
        0.326206441934858,
        0.312859253130796,
        0.34774176649356,
        0.364204978476831,
        0.31264397679181,
        0.324143569632298
      ),
      inertia_upr_TV = c(
        2.45353624138338,
        2.76471919687013,
        2.48163733192076,
        2.66234821182402,
        2.21644565408139,
        2.38002887810369,
        2.32146984172791,
        2.25239378087939,
        2.5008554208836,
        2.7135751541142,
        2.25973372508189,
        2.32612717154504
      ),
      maxamp_TV = c(
        1.72349559195705,
        1.8697983906695,
        1.73108148235081,
        1.81936700059609,
        1.60911983941647,
        1.68605203689836,
        1.65545811100756,
        1.62556420309109,
        1.7402076523295,
        1.84355800955232,
        1.63054094294715,
        1.66067355315183
      ),
      maxamp_upr_TV = c(
        3.18858930444568,
        3.7229201541818,
        3.23803651041085,
        3.54807857936658,
        2.77083987704257,
        3.06109963762469,
        2.95942743832221,
        2.83576226234216,
        3.27115294144084,
        3.63542785019607,
        2.84802255848336,
        2.96645800973361
      ),
      maxatt_TV = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
      maxatt_lwr_TV = c(
        0.13778654164732,
        0.132532236589621,
        0.139339465047642,
        0.135280850303459,
        0.137989072327399,
        0.13929338617277,
        0.140517199952964,
        0.138900780044175,
        0.139049128386117,
        0.134215917301808,
        0.138354343842206,
        0.139349031986501
      ),
      reac_TV = c(
        1.32304400699787,
        1.45498944615685,
        1.33363668707327,
        1.41054154482249,
        1.22366593294856,
        1.2918054703702,
        1.267075528417,
        1.23863866120901,
        1.34167681992992,
        1.43233452399349,
        1.24178184433908,
        1.2693556162567
      ),
      reac_lwr_TV = c(
        0.532443370425783,
        0.572350274278045,
        0.54361299764399,
        0.563482515141263,
        0.490764238881772,
        0.523998701142372,
        0.517362345689035,
        0.499736634117195,
        0.546295102658785,
        0.569303318837307,
        0.499244415915966,
        0.514266095807334
      ),
      reac_upr_TV = c(
        2.8950774175616,
        3.38210137146261,
        2.9353591147084,
        3.2197201793316,
        2.51851467127197,
        2.77800751046083,
        2.68479226863399,
        2.57600280481855,
        2.96533847524873,
        3.29957467099336,
        2.58780605230581,
        2.69303448262002
      )
    ),
    class = c("resil", "data.frame"),
    row.names = c(NA, -12L)
  )

  expect_equal(job, result, tolerance = 0.001)
})
